<!-- front end static website. There are many places that need to be hooked up with API or made dynamic. See comments -->
<!DOCTYPE html>
<html>
<title>MarketInform Inc.</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.3.0/dist/chart.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{{ url_for('static',    filename='sentiment.js') }}"></script>
<body class="w3-light-grey">

<!-- Top container -->
<div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
  <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>
  <span class="w3-bar-item w3-right">Logo</span>
</div>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
  <div class="w3-container w3-row">
    <div class="w3-col s4">
      <img src="/static/spongebob.jpg" class="w3-circle w3-margin-right" style="width:46px">
    </div>
    <div class="w3-col s8 w3-bar">
      <span><strong>Welcome to MarketInform!!!</strong> </span><br>
    </div>
  </div>
  <hr>
  <div class="w3-container">
    <h5>Dashboard</h5>
  </div>
  <div class="w3-bar-block">
    <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>
    <a href="#" class="w3-bar-item w3-button w3-padding w3-blue"><i class="fa fa-users fa-fw"></i>  Overview</a>
    <a href="#industry" class="w3-bar-item w3-button w3-padding"><i class="fa fa-eye fa-fw"></i>  Industries</a>
    <a href="#stocks" class="w3-bar-item w3-button w3-padding"><i class="fa fa-users fa-fw"></i>  Stocks</a>
    <a href="#news" class="w3-bar-item w3-button w3-padding"><i class="fa fa-bell fa-fw"></i>  News</a>
  </div>
</nav>


<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:300px;margin-top:43px;">

  <!-- Header -->
  <header class="w3-container" style="padding-top:22px">
    
    <div class="w3-bar w3-blue">
        <div class="w3-bar-item"><h5><b><i class="fa fa-dashboard"></i> Major Market Index</b></h5></div>
      </div>
  </header>

  

  <div class="w3-row-padding w3-margin-bottom">
    <div class="w3-quarter">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/symbols/EURUSD/?exchange=FX" rel="noopener" target="_blank"><span class="blue-text">EURUSD Rates</span></a> by TradingView</div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
            {
            "symbol": "FOREXCOM:SPXUSD",
            "width": 350,
            "height": 220,
            "locale": "en",
            "dateRange": "12M",
            "colorTheme": "light",
            "trendLineColor": "#37a6ef",
            "underLineColor": "#E3F2FD",
            "isTransparent": false,
            "autosize": false,
            "largeChartUrl": ""
            }
            </script>
        </div>
    </div>
    <div class="w3-quarter">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/symbols/EURUSD/?exchange=FX" rel="noopener" target="_blank"><span class="blue-text">EURUSD Rates</span></a> by TradingView</div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
            {
            "symbol": "FOREXCOM:DJI",
            "width": 350,
            "height": 220,
            "locale": "en",
            "dateRange": "12M",
            "colorTheme": "light",
            "trendLineColor": "#37a6ef",
            "underLineColor": "#E3F2FD",
            "isTransparent": false,
            "autosize": false,
            "largeChartUrl": ""
            }
            </script>
        </div>
    </div>
    <div class="w3-quarter">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/symbols/EURUSD/?exchange=FX" rel="noopener" target="_blank"><span class="blue-text">EURUSD Rates</span></a> by TradingView</div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
            {
            "symbol": "FOREXCOM:NSXUSD",
            "width": 350,
            "height": 220,
            "locale": "en",
            "dateRange": "12M",
            "colorTheme": "light",
            "trendLineColor": "#37a6ef",
            "underLineColor": "#E3F2FD",
            "isTransparent": false,
            "autosize": false,
            "largeChartUrl": ""
            }
            </script>
        </div>
    </div>
  </div>

  <div class="w3-panel">
    <div class="w3-row-padding" style="margin:0 -16px">
      <div class="w3-third">
        <h5>Major Stocks</h5>
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/markets/stocks-usa/" rel="noopener" target="_blank"><span class="blue-text">Stock Quotes</span></a> by TradingView</div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
            {
            "title": "Stocks",
            "tabs": [
              {
                "title": "Financial",
                "symbols": [
                  {
                    "s": "NYSE:JPM",
                    "d": "Jpmorgan Chase & Co"
                  },
                  {
                    "s": "NYSE:WFC",
                    "d": "Wells Fargo Co New"
                  }
                ]
              },
              {
                "title": "Technology",
                "symbols": [
                  {
                    "s": "NASDAQ:AAPL",
                    "d": "Apple"
                  },
                  {
                    "s": "NASDAQ:GOOGL",
                    "d": "Google Inc"
                  }
                ]
              },
              {
                "title": "Services",
                "symbols": [
                  {
                    "s": "NASDAQ:AMZN",
                    "d": "Amazon Com Inc"
                  },
                  {
                    "s": "NYSE:BABA",
                    "d": "Alibaba Group Hldg Ltd"
                  }
                ]
              }
            ],
            "width": 400,
            "height": 450,
            "showChart": true,
            "locale": "en",
            "plotLineColorGrowing": "rgba(33, 150, 243, 1)",
            "plotLineColorFalling": "rgba(33, 150, 243, 1)",
            "belowLineFillColorGrowing": "rgba(33, 150, 243, 0.12)",
            "belowLineFillColorFalling": "rgba(33, 150, 243, 0.12)",
            "gridLineColor": "#F0F3FA",
            "scaleFontColor": "rgba(120, 123, 134, 1)",
            "showSymbolLogo": true,
            "symbolActiveColor": "rgba(33, 150, 243, 0.12)",
            "colorTheme": "light"
            }
            </script>
        </div>
      </div>

      <!-- using api to call the news title or summary here -->
      <div class="w3-twothird">
        <h5>News Feeds</h5>
        <table class="w3-table w3-striped w3-white">
          <tr>
            <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
            <td id="news-1">New record, over 90 views.</td>
            <td><i>10 mins</i></td>
          </tr>
          <tr>
            <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
            <td id="news-2">Database error.</td>
            <td><i>15 mins</i></td>
          </tr>
          <tr>
            <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
            <td id="news-3">New record, over 40 users.</td>
            <td><i>17 mins</i></td>
          </tr>
          <tr>
            <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
            <td id="news-4">New comments.</td>
            <td><i>25 mins</i></td>
          </tr>
          <tr>
            <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
            <td id="news-5">Check transactions.</td>
            <td><i>28 mins</i></td>
          </tr>
          <tr>
            <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
            <td id="news-6">CPU overload.</td>
            <td><i>35 mins</i></td>
          </tr>
          <tr>
            <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
            <td id="news-7">New shares.</td>
            <td><i>39 mins</i></td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <a id="industry"></a>
  <!-- add overall industry sentiment here -->
  <hr>
  <div class="w3-bar w3-blue">
    <div class="w3-bar-item"><h5><b><strong>Industry Sentiment</strong></b></h5></div>
  </div>

  <div class="w3-container">
    <div class="w3-row-padding w3-margin-bottom">
        <div class="w3-quarter">
            <div class="w3-container w3-green w3-padding-16">
                <div class="w3-left"><h3>Tech</h3></div>

                <div class="w3-clear"></div>
                <h4 id="tech-sentiment">Sentiment Score: </h4>
                </div>
        </div>

        <div class="w3-quarter">
            <div class="w3-container w3-indigo w3-padding-16">
                <div class="w3-left"><h3>Finance</h3></div>
    
                <div class="w3-clear"></div>
                <h4 id="finance-sentiment">Sentiment Score: </h4>
                </div>
        </div>

        <div class="w3-quarter">
            <div class="w3-container w3-lime w3-padding-16">
                <div class="w3-left"><h3>Agriculture</h3></div>
    
                <div class="w3-clear"></div>
                <h4 id="ag-sentiment">Sentiment Score: </h4>
                </div>
        </div>
        
        <div class="w3-quarter">
            <div class="w3-container w3-khaki w3-padding-16">
                <div class="w3-left"><h3>Consumer Goods</h3></div>
    
                <div class="w3-clear"></div>
                <h4 id="cannabis-sentiment">Sentiment Score: </h4>
                </div>
        </div>
    </div>

    <div class="w3-row-padding w3-margin-bottom">
        <!-- <p>New Visitors</p> -->
        <div class="w3-quarter">
            <div class="w3-container w3-grey w3-padding-16">
                <div class="w3-left"><h3>Energy</h3></div>
    
                <div class="w3-clear"></div>
                <h4 id="energy-sentiment">Sentiment Score: </h4>
                </div>
        </div>

        <div class="w3-quarter">
            <div class="w3-container w3-orange w3-padding-16">
                <div class="w3-left"><h3>Automobile</h3></div>
    
                <div class="w3-clear"></div>
                <h4 id="automobile-sentiment">Sentiment Score: </h4>
                </div>
        </div>

        <div class="w3-quarter">
            <div class="w3-container w3-purple w3-padding-16">
                <div class="w3-left"><h3>Real Estate</h3></div>
    
                <div class="w3-clear"></div>
                <h4 id="re-sentiment">Sentiment Score: </h4>
                </div>
        </div>

        <div class="w3-quarter">
            <div class="w3-container w3-teal w3-padding-16">
                <div class="w3-left"><h3>Pharmaceutical</h3></div>
    
                <div class="w3-clear"></div>
                <h4 id="pharma-sentiment">Sentiment Score: </h4>
                </div>
        </div>
    </div>
    </div>
      <a id="stocks"></a>

  <hr>

  <!-- Stock sentiment score and API call here -->
  <div class="w3-container">
    <div class="w3-bar w3-blue">
        <div class="w3-bar-item"><h5><b><strong>Stock Sentiment</strong></b></h5></div>
        <div class="w3-right">
            <div class="search-container">
                    <i id="spinner" class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
                    <span class="sr-only">Loading...</span>
                  <input id="submit-stock" type="text" placeholder="AAPL" name="search">
                  <button id="submit-button" onclick="updateChart">Submit</button>
            </div>
        </div>

    </div>
    
    <canvas id="myChart" width="1500" height="480"></canvas>
    <script>
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart;
    $.ajax({
        type: 'GET', //post method
        url: '/stock/AAPL', //ajaxformexample url
        dataType: "json",
        success: function (result, textStatus, jqXHR)
        {
            var dates = [];
            for (var i = 0; i < result.length; i++){
                dates.push(result[i]['date']);
            }

            var sentiments = [];
            for (var i = 0; i < result.length; i++){
                sentiments.push(parseFloat(result[i]['sentiment']));
            }

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Sentiment',
                        data: sentiments,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1,
                        padding: 8
                    }]
                },
                options: {
                    responsive: false,
                    scales: {
                        y: {
                            suggestedMin: -1,
                            suggestedMax: 1                }
                    }
                }
            });
        },
        error: function (jqXHR, exception)
        {
            console.log(exception);
        }
    });
    
    </script>
    <script>
        $('#spinner').hide();
        function updateChart(){
            $('#spinner').show();
            var stock_name = document.getElementById('submit-stock').value;

            // updates news for the stock
            $.ajax({
                type: 'GET',
                url: 'https://api.us-south.discovery.watson.cloud.ibm.com/instances/d19e700b-3209-4869-a8bb-279a7b7c4e8a/v1/environments/system/collections/news-en/query?version=2019-04-30&query=enriched_text.entities.text:' + stock_name,
                dataType: 'json',
                headers: {
                    "Authorization" : "Basic " + btoa("apikey:a-pugZwx81CeazpgllKNPgfWxIXBYGgpJj-qsIq4MsVb")
                },
                success: function (data){
                    $('#stock-news-1').html('<a target="_blank" href="'+ data.results[0].url +'">'+ data.results[0].title +'</a>');
                    $('#stock-news-2').html('<a target="_blank" href="'+ data.results[1].url +'">'+ data.results[1].title +'</a>');
                    $('#stock-news-3').html('<a target="_blank" href="'+ data.results[2].url +'">'+ data.results[2].title +'</a>');
                  }
                //crossDomain: true,
                //dataType: 'jsonp',
            });


            $.ajax({
                type: 'GET', //post method
                url: '/stock/'+stock_name, //ajaxformexample url
                dataType: "json",
                success: function (result, textStatus, jqXHR)
                {
                    $('#spinner').hide();

                    var dates = [];
                    for (var i = 0; i < result.length; i++){
                        dates.push(result[i]['date']);
                    }

                    var sentiments = [];
                    for (var i = 0; i < result.length; i++){
                        sentiments.push(parseFloat(result[i]['sentiment']));
                    }

                    myChart.destroy();
                    myChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'Sentiment',
                                data: sentiments,
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.2)',
                                    'rgba(54, 162, 235, 0.2)',
                                    'rgba(255, 206, 86, 0.2)',
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(153, 102, 255, 0.2)',
                                    'rgba(255, 159, 64, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1,
                                padding: 8
                            }]
                        },
                        options: {
                            responsive: false,
                            scales: {
                                y: {
                                    suggestedMin: -1,
                                    suggestedMax: 1                }
                            }
                        }
                    });
                },
                error: function (jqXHR, exception)
                {
                    console.log(exception);
                }
            });


            $("#stock-chart").replaceWith("<!-- Need to make the stock symbol dynamic -->\r\n    <div id=\"stock-chart\" class=\"tradingview-widget-container\">\r\n        <h5>Price Movements<\/h5>\r\n        <div id=\"tradingview_3242d\"><\/div>\r\n        <div class=\"tradingview-widget-copyright\"><a href=\"https:\/\/www.tradingview.com\/symbols\/" + stock_name + "\/\" rel=\"noopener\" target=\"_blank\"><span class=\"blue-text\">"+ stock_name +"<\/span><\/a> by TradingView<\/div>\r\n        <script type=\"text\/javascript\" src=\"https:\/\/s3.tradingview.com\/tv.js\"><\/script>\r\n        <script type=\"text\/javascript\">\r\n        new TradingView.MediumWidget(\r\n        {\r\n        \"symbols\": [\r\n        [\r\n            \""+ stock_name +"\",\r\n            \"" + stock_name + "\"\r\n        ]\r\n        ],\r\n        \"chartOnly\": false,\r\n        \"width\": 1500,\r\n        \"height\": 480,\r\n        \"locale\": \"en\",\r\n        \"colorTheme\": \"light\",\r\n        \"gridLineColor\": \"#F0F3FA\",\r\n        \"trendLineColor\": \"#2196F3\",\r\n        \"fontColor\": \"#787B86\",\r\n        \"underLineColor\": \"#E3F2FD\",\r\n        \"isTransparent\": false,\r\n        \"autosize\": false,\r\n        \"container_id\": \"tradingview_3242d\"\r\n    }\r\n        );\r\n        <\/script>\r\n    <\/div>\r\n  <\/div>");
        }
        document.getElementById("submit-button").addEventListener("click", updateChart);
    </script>

    <!-- Need to make the stock symbol dynamic -->
    <div id="stock-chart" class="tradingview-widget-container">
        <h5>Price Movements</h5>
        <div id="tradingview_3242d"></div>
        <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/symbols/AAPL/" rel="noopener" target="_blank"><span class="blue-text">Apple</span></a> by TradingView</div>
        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
        <script type="text/javascript">
        new TradingView.MediumWidget(
        {
        "symbols": [
        [
            "Apple",
            "AAPL"
        ]
        ],
        "chartOnly": false,
        "width": 1500,
        "height": 480,
        "locale": "en",
        "colorTheme": "light",
        "gridLineColor": "#F0F3FA",
        "trendLineColor": "#2196F3",
        "fontColor": "#787B86",
        "underLineColor": "#E3F2FD",
        "isTransparent": false,
        "autosize": false,
        "container_id": "tradingview_3242d"
    }
        );
        </script>
    </div>
  </div>
  <a id="news"></a>

  <!-- Need to display the news related to the stock -->
  <hr>
  <div class="w3-container">
    <h5>Recent News</h5>
    <ul class="w3-ul w3-card-4 w3-white">
      <li class="w3-padding-16">
        <span id="stock-news-1" class="w3-xlarge">News 1</span><br>
      </li>
      <li class="w3-padding-16">
        <span id="stock-news-2" class="w3-xlarge">News 2</span><br>
      </li>
      <li class="w3-padding-16">
        <span id="stock-news-3" class="w3-xlarge">News 3</span><br>
      </li>
    </ul>
  </div>
  <hr>

  <!-- Footer -->
  <footer class="w3-container w3-padding-16 w3-light-grey">
    <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
  </footer>

  <!-- End page content -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>
</body>
</html>
